*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 01/08/93            ADDUSERS.PRG               10:48:05 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 1993 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ

PARAMETERS m.cardid

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є         ADDUSERS/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("_qcb0n5gc9")
	DEFINE WINDOW _qcb0n5gc9 ;
		FROM INT((SROW()-14)/2),INT((SCOL()-66)/2) ;
		TO INT((SROW()-14)/2)+13,INT((SCOL()-66)/2)+65 ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 5
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є         ADDUSERS/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PRIVATE m.mover, m.user, m.allcnt, m.saverec, m.usrcnt, m.limit, ;
	allusers, m.status, m.savearea,  m.userlast, m.userfirst

SET EXACT ON
m.user = 1
m.userlast = ""
m.status   = .T.
m.savearea = SELECT()
DIMENSION allusers[1,3]
allusers = ""

IF NOT locatedb("carduser",1)
	RETURN
ENDIF

m.saverec = RECNO()
SELECT DISTINCT lastname, firstname, ;
	ALLTRIM(firstname)+" "+ALLTRIM(lastname) ;
	FROM carduser ;
	INTO ARRAY allusers

m.allcnt = ALEN(allusers,1)

IF EMPTY(users)
	m.usrcnt = 0
ELSE
	m.usrcnt = 1
	m.limit  = ALEN(users,1)
	DO WHILE m.usrcnt <= m.limit
		IF EMPTY(users[m.usrcnt,1])
			EXIT
		ENDIF
		m.usrcnt = m.usrcnt + 1
	ENDDO
	m.usrcnt = m.usrcnt - 1
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              ADDUSERS/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("_qcb0n5gc9")
	ACTIVATE WINDOW _qcb0n5gc9 SAME
ELSE
	ACTIVATE WINDOW _qcb0n5gc9 NOSHOW
ENDIF
@ 7,41 SAY "Last:" ;
	SIZE 1,5, 0
@ 9,41 SAY "First:" ;
	SIZE 1,6, 0
@ 2,25 GET m.mover ;
	PICTURE "@*VN \<Move  ;   \<Remove;\\Remove \<All;\<New Name;\!\<OK" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _qcb0n5gw5()
@ 1,1 GET m.alluser ;
 	PICTURE "@&N" ;
	FROM allusers ;
	RANGE 3, m.allcnt ;
	SIZE 10,22 ;
	DEFAULT 1 ;
	VALID _qcb0n5h3k() ;
	COLOR SCHEME 5
@ 1,40 GET m.user ;
 	PICTURE "@&N" ;
	FROM users ;
	RANGE 3, usrcnt ;
	SIZE 6,22 ;
	DEFAULT 1 ;
	VALID _qcb0n5h84() ;
	COLOR SCHEME 5
@ 7,54 GET m.gethelp ;
	PICTURE "@*HN \<Help" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID _qcb0n5hbg()
@ 8,41 GET m.userlast ;
	SIZE 1,22 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _qcb0n5hdo() ;
	VALID _qcb0n5hfl() ;
	ERROR "Blank entries are not allowed" ;
	DISABLE
@ 10,41 GET m.userfirst ;
	SIZE 1,15 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _qcb0n5hid() ;
	VALID _qcb0n5hkc() ;
	DISABLE
@ 0,41 SAY "Authorized Users:" ;
	SIZE 1,17, 0
@ 0,2 SAY "Selection List:" ;
	SIZE 1,15, 0

IF NOT WVISIBLE("_qcb0n5gc9")
	ACTIVATE WINDOW _qcb0n5gc9
ENDIF

READ CYCLE MODAL ;
	WHEN _qcb0n5hqk() ;
	ACTIVATE _qcb0n5hqn() ;
	SHOW _qcb0n5hqq()

RELEASE WINDOW _qcb0n5gc9

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              ADDUSERS/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
SET EXACT OFF

ON KEY LABEL esc
SELECT (m.savearea)
RETURN m.status

*
* ALREADYIN - Check if name already in the list.
*


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є  ADDUSERS/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
FUNCTION alreadyin
PARAMETER m.newname
SET EXACT OFF
IF ASCAN(users, ALLTRIM(m.newname)) <> 0
	RETURN .T.
ENDIF
SET EXACT ON
RETURN .F.

*
* ESCHANDLER - Handle ESC-aping out of a field.
*
PROCEDURE eschandler
ON KEY LABEL esc
m.userlast  = SPACE(22)
m.userfirst = SPACE(14)
SHOW GET m.userlast DISABLE
SHOW GET m.userfirst DISABLE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5GW5           m.mover VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    4  є
*       є Variable:            m.mover                            є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5gw5     &&  m.mover VALID
#REGION 1
DO CASE
CASE m.mover = 1
	IF alreadyin(allusers[m.alluser,3]))
		WAIT WINDOW "Duplicate entry" NOWAIT
		RETURN .F.
	ENDIF
	IF m.usrcnt+1 > ALEN(users,1)
		DIMENSION users[m.usrcnt+1,3]
	ENDIF
	users[m.usrcnt+1,1] = allusers[m.alluser,1]
	users[m.usrcnt+1,2] = allusers[m.alluser,2]
	users[m.usrcnt+1,3] = allusers[m.alluser,3]
	m.usrcnt = m.usrcnt + 1
	m.user = m.usrcnt
	SHOW GET m.mover, 2 ENABLE
	IF m.usrcnt > 1
		SHOW GET m.mover, 3 ENABLE
	ENDIF
	SHOW GET m.user
CASE m.mover = 2
	= ADEL(users, m.user)
	m.usrcnt = m.usrcnt - 1
	m.user = m.usrcnt
	
	IF m.usrcnt = 0
		SHOW GET m.mover, 2 DISABLE
		SHOW GET m.mover, 3 DISABLE
	ENDIF
	SHOW GET m.user
CASE m.mover = 3
	users = ""
	m.usrcnt = 0
	SHOW GET m.mover, 2 DISABLE
	SHOW GET m.mover, 3 DISABLE
	SHOW GET m.user
CASE m.mover = 4
	m.userlast  = SPACE(22)
	m.userfirst = SPACE(14)
	SHOW GET m.userlast ENABLE
	_CUROBJ = OBJNUM(m.userlast)
CASE m.mover = 5
	CLEAR READ
ENDCASE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5H3K           m.alluser VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    5  є
*       є Variable:            m.alluser                          є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5h3k     &&  m.alluser VALID
#REGION 1
IF alreadyin(allusers[m.alluser,3])
	WAIT WINDOW "Duplicate entry" NOWAIT
	RETURN .F.
ENDIF
IF m.usrcnt+1 > ALEN(users,1)
	DIMENSION users[m.usrcnt+1,3]
ENDIF
	
users[m.usrcnt+1,1] = allusers[m.alluser,1]
users[m.usrcnt+1,2] = allusers[m.alluser,2]
users[m.usrcnt+1,3] = allusers[m.alluser,3]
m.usrcnt = m.usrcnt + 1
m.user = m.usrcnt

SHOW GET m.mover, 2 ENABLE
IF m.usrcnt > 1
	SHOW GET m.mover, 3 ENABLE
ENDIF
SHOW GET m.user
		


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5H84           m.user VALID                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    6  є
*       є Variable:            m.user                             є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5h84     &&  m.user VALID
#REGION 1
= ADEL(users, m.user)
m.usrcnt = m.usrcnt - 1
m.user = m.usrcnt
		
IF m.usrcnt = 0
	SHOW GET m.mover, 2 DISABLE
	SHOW GET m.mover, 3 DISABLE
ENDIF
SHOW GET m.user


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HBG           m.gethelp VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    7  є
*       є Variable:            m.gethelp                          є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hbg     &&  m.gethelp VALID
#REGION 1
HELP ю Add/Modify card users

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HDO           m.userlast WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    8  є
*       є Variable:            m.userlast                         є
*       є Called By:           WHEN Clause                        є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hdo     &&  m.userlast WHEN
#REGION 1
ON KEY LABEL esc DO eschandler


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HFL           m.userlast VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    8  є
*       є Variable:            m.userlast                         є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hfl     &&  m.userlast VALID
#REGION 1
IF EMPTY(m.userlast)
	RETURN .F.
ENDIF

SHOW GET m.userfirst ENABLE
_CUROBJ = OBJNUM(m.userfirst)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HID           m.userfirst WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    9  є
*       є Variable:            m.userfirst                        є
*       є Called By:           WHEN Clause                        є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hid     &&  m.userfirst WHEN
#REGION 1
ON KEY LABEL esc DO eschandler

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HKC           m.userfirst VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS,     Record Number:    9  є
*       є Variable:            m.userfirst                        є
*       є Called By:           VALID Clause                       є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hkc     &&  m.userfirst VALID
#REGION 1
IF EMPTY(m.userfirst)
	WAIT WINDOW "Blank entries are not allowed" NOWAIT
	RETURN .F.
ENDIF
IF alreadyin(ALLTRIM(m.userfirst)+" "+ALLTRIM(m.userlast))
	WAIT WINDOW "Duplicate entry" NOWAIT
	RETURN .F.
ENDIF

IF m.usrcnt+1 > ALEN(users,1)
	DIMENSION users[m.usrcnt+1,3]
ENDIF
	
users[m.usrcnt+1,1] = m.userlast
users[m.usrcnt+1,2] = m.userfirst
users[m.usrcnt+1,3] = ALLTRIM(users[m.usrcnt+1,2])+;
	" "+ALLTRIM(users[m.usrcnt+1,1])

m.usrcnt = m.usrcnt + 1
m.user = m.usrcnt
	
SHOW GET m.mover, 2 ENABLE
IF m.usrcnt > 1
	SHOW GET m.mover, 3 ENABLE
ENDIF
SHOW GET m.user
	
m.userlast  = SPACE(22)
m.userfirst = SPACE(14)
SHOW GET m.userlast DISABLE
SHOW GET m.userfirst DISABLE

_CUROBJ = OBJNUM(m.mover)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HQK           Read Level When                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS                           є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hqk     && Read Level When
*
* When Code from screen: ADDUSERS
*
#REGION 1
IF EMPTY(m.cardid)
	WAIT WINDOW "You must enter card id first" NOWAIT
	m.status = .F.
	RETURN .F.
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HQN           Read Level Activate                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS                           є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hqn     && Read Level Activate
*
* Activate Code from screen: ADDUSERS
*
#REGION 1
SHOW GET m.mover, 1 PROMPT "\<Move "+CHR(26)
SHOW GET m.mover, 2 PROMPT CHR(27)+" \<Remove"

IF EMPTY(allusers)
	SHOW GET m.alluser DISABLE
ENDIF
IF m.usrcnt=0
	SHOW GET m.mover, 2 DISABLE
ENDIF

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _QCB0N5HQQ           Read Level Show                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         ADDUSERS                           є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _qcb0n5hqq     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: ADDUSERS
*
#REGION 1
IF m.usrcnt > 1
	SHOW GET m.mover, 3 ENABLE
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF