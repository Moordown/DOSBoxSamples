*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        11/23/92             APPSRCH.SPR               15:33:17 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1992 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("_qb00xc7wi")
	DEFINE WINDOW _qb00xc7wi ;
		FROM INT((SROW()-13)/2),INT((SCOL()-28)/2) ;
		TO INT((SROW()-13)/2)+12,INT((SCOL()-28)/2)+27 ;
		TITLE " Search for: " ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 5
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 APPSRCH/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF TYPE("srchterm") $ "UL" OR EMPTY(m.srchterm)
   m.srchterm = SPACE(60)
ENDIF
m.oksrch = 1
m.fldnum = 0

DIMENSION fldarry(10,4)   && default dimensions.  AFIELDS will reset if necessary.
m.fldcnt = AFIELDS(fldarry)
m.startord = ORDER()
m.startalias = ALIAS()

m.curord = ORDER()
IF EMPTY(m.curord)
   SET ORDER TO 1
   m.curord = ORDER()
ENDIF

FOR i = 1 TO FCOUNT()
   IF FIELDS(i) == m.curord
      m.fldnum = i
   ENDIF
ENDFOR

IF m.fldnum > 0
   m.fldname = FIELDS(m.fldnum)
ELSE
   SET ORDER TO 1
   m.fldnum  = 1
   m.fldname = FIELDS(1)
ENDIF

skipvar = .T.

curs_stat = (UPPER(SET("CURSOR")) = "ON")
SET CURSOR ON


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     APPSRCH/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("_qb00xc7wi")
	ACTIVATE WINDOW _qb00xc7wi SAME
ELSE
	ACTIVATE WINDOW _qb00xc7wi NOSHOW
ENDIF
@ 4,3 SAY "in:" ;
	SIZE 1,3, 0
@ 1,1 GET m.srchterm ;
	SIZE 1,24 ;
	DEFAULT " " ;
	PICTURE "@S60" ;
	WHEN _qb00xc8sy()
@ 3,7 GET fldnum ;
	PICTURE "@^" ;
	FROM fldarry ;
	SIZE 3,12 ;
	DEFAULT 1 ;
	VALID _qb00xc90y() ;
	COLOR SCHEME 5, 6
@ 7,8 GET oksrch ;
	PICTURE "@*VN \!\<OK;\?\<Cancel" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _qb00xc96e()

IF NOT WVISIBLE("_qb00xc7wi")
	ACTIVATE WINDOW _qb00xc7wi
ENDIF

READ CYCLE MODAL ;
	ACTIVATE _qb00xc9ud() ;
	DEACTIVATE _qb00xc9ui()

RELEASE WINDOW _qb00xc7wi

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      APPSRCH/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF curs_stat
   SET CURSOR ON
ELSE
   SET CURSOR OFF
ENDIF
skipvar = .F.



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*          APPSRCH/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
FUNCTION gettag
*) Returns tag number corresponding to field "fldname", or 0 if there
*) is not tag with the same name as "fldname."
parameter fldname
PRIVATE ALL
m.fldname = UPPER(ALLTRIM(m.fldname))
i = 1
DO WHILE !EMPTY(TAG(i)) AND i < 1000
   IF UPPER(TAG(i)) == m.fldname
      RETURN i
   ENDIF
   i = i + 1
ENDDO
RETURN 0


PROCEDURE waitmsg
IF RECCOUNT() > 1000
   WAIT WINDOW "Searching.  This may take a few moments." NOWAIT
ELSE
   WAIT WINDOW "Searching" NOWAIT
ENDIF



PROCEDURE doloc
PARAMETERS term, answer
* See if the user wants to do a long substring search

IF NOT WEXIST("doloc")
   DEFINE WINDOW doloc ;
      FROM INT((srow()-9)/2),INT((scol()-62)/2) ;
      TO INT((srow()-9)/2)+8,INT((scol()-62)/2)+61 ;
      FLOAT ;
      NOCLOSE ;
      SHADOW ;
      DOUBLE ;
      COLOR SCHEME 5
ENDIF

answer = .F.
ACTIVATE WINDOW doloc NOSHOW

@ 5,16 GET locok ;
   PICTURE "@*HT \!\<Search;\?\<Cancel" ;
   SIZE 1,12,4 ;
   DEFAULT 1
@ 1,1 SAY "FoxApp was not able to find a record matching your search"
@ 2,1 SAY "term while using a fast searching method.  Do you want to"
@ 3,1 SAY "search for the term with slower but more thorough methods?"

IF NOT WVISIBLE("doloc")
   ACTIVATE WINDOW doloc
ENDIF

READ CYCLE MODAL

RELEASE WINDOW doloc
answer = (locok = 1)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB00XC8SY           m.srchterm WHEN                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         APPSRCH,     Record Number:    3   
*        Variable:            m.srchterm                         
*        Called By:           WHEN Clause                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qb00xc8sy     &&  m.srchterm WHEN
#REGION 1
m.srchterm = PADR(m.srchterm,60)
SHOW GETS


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB00XC90Y           fldnum VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         APPSRCH,     Record Number:    4   
*        Variable:            fldnum                             
*        Called By:           VALID Clause                       
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qb00xc90y     &&  fldnum VALID
#REGION 1
m.fldname = FIELDS(m.fldnum)
tagnum = gettag(m.fldname)     && tag number of tag with name fldname

IF tagnum > 0
   SET ORDER TO TAG(m.tagnum)
ELSE
   SET ORDER TO 0
ENDIF
SHOW GETS


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB00XC96E           oksrch VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         APPSRCH,     Record Number:    5   
*        Variable:            oksrch                             
*        Called By:           VALID Clause                       
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qb00xc96e     &&  oksrch VALID
#REGION 1
skipvar = .F.
IF m.oksrch = 1 AND !EMPTY(m.srchterm)
   m.srchterm = ALLTRIM(m.srchterm)
   WAIT CLEAR

   m.tagnum = gettag(m.fldname)
   IF m.tagnum > 0
      SET ORDER TO TAG(m.tagnum)
   ELSE
      DO waitmsg   && warn user that this may take a while
   ENDIF
   m.thisrec = RECNO()
   DO CASE
   CASE TYPE("&fldname") $ "CM"     && character or memo field
      IF m.tagnum > 0
         SEEK ALLTRIM(m.srchterm)
         IF !FOUND()
            IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
               GOTO m.thisrec
            ENDIF
            answer = .F.
            DO doloc WITH m.srchterm, m.answer   && prompt for locate

            IF m.answer = .T.
               DO waitmsg
               GOTO TOP
               LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
            ENDIF
         ENDIF
      ELSE
         LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
      ENDIF
   CASE TYPE("&fldname") $ "FN"     && floating or numeric
      m.srchterm = CHRTRAN(m.srchterm,'"','')
      m.srchterm = CHRTRAN(m.srchterm,"'","")
      LOCATE FOR VAL(ALLTRIM(m.srchterm)) = &fldname
   CASE TYPE("&fldname") = "D"      && date
      m.srchterm = CHRTRAN(m.srchterm,'{}"()','')
      m.srchterm = CHRTRAN(m.srchterm,"'",'')
      m.srchterm = ALLTRIM(m.srchterm)
      LOCATE FOR CTOD(srchterm) = &fldname
   CASE TYPE("&fldname") = "L"      && logical
      IF "T" $ UPPER(m.srchterm)
         LOCATE FOR &fldname
      ELSE
         LOCATE FOR !&fldname
      ENDIF
   CASE TYPE("&fldname") = "U"      && unknown field type--should't happen
      WAIT WINDOW "Field "+m.fldname+" not found"
   ENDCASE
   IF !FOUND()
      SET CURSOR OFF
      WAIT WINDOW "Not found" NOWAIT
      IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
         GOTO m.thisrec
      ENDIF
   ELSE
      SET CURSOR OFF
      WAIT WINDOW "Found it!" NOWAIT
      CLEAR READ
   ENDIF
ELSE
   SET ORDER TO (m.startord)
   CLEAR READ
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB00XC9UD           Read Level Activate                
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         APPSRCH                            
*        Called By:           READ Statement                     
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qb00xc9ud     && Read Level Activate
*
* Activate Code from screen: APPSRCH
*
#REGION 1
SELECT (m.startalias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB00XC9UI           Read Level Deactivate              
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         APPSRCH                            
*        Called By:           READ Statement                     
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qb00xc9ui     && Read Level Deactivate
*
* Deactivate Code from screen: APPSRCH
*
#REGION 1
?? CHR(7)
RETURN .F.
