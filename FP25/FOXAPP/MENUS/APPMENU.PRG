*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        11/30/92             APPMENU.PRG              15:30:48  
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Walter J. Kennamer                                      
*                                                                
*        Copyright (c) 1992 Microsoft Corp.                      
*        One Microsoft Way                                       
*        Redmond, WA  Zip                                        
*                                                                
*        Description:                                            
*        This program was automatically generated by GENMENU.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                               Setup Code                       
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

SET SYSMENU AUTOMATIC
EXTERNAL PROCEDURE showpop, juststem, justfname, justpath, addbs, ;
   forceext, defaultext, justext

IF TYPE("SKIPVAR") <> "U"
   RELEASE m.skipvar
ENDIF
PUBLIC m.skipvar
m.skipvar = .F.
CLEAR MACRO


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                             Menu Definition                    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

SET SYSMENU TO

SET SYSMENU AUTOMATIC

DEFINE PAD _qb70x90w0 OF _MSYSMENU PROMPT "\<System" COLOR SCHEME 3 ;
	KEY ALT+S, ""
DEFINE PAD _qb70x90wf OF _MSYSMENU PROMPT "\<Edit" COLOR SCHEME 3 ;
	KEY ALT+E, ""
DEFINE PAD _qb70x90wg OF _MSYSMENU PROMPT "\<Application" COLOR SCHEME 3 ;
	KEY ALT+A, ""
DEFINE PAD _qb70x90wx OF _MSYSMENU PROMPT "\<Utilities" COLOR SCHEME 3 ;
	KEY ALT+U, ""
ON PAD _qb70x90w0 OF _MSYSMENU ACTIVATE POPUP system
ON PAD _qb70x90wf OF _MSYSMENU ACTIVATE POPUP edit
ON PAD _qb70x90wg OF _MSYSMENU ACTIVATE POPUP applic
ON PAD _qb70x90wx OF _MSYSMENU ACTIVATE POPUP utilities

DEFINE POPUP system MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF system PROMPT "\<About..."
DEFINE BAR _MST_HELP OF system PROMPT "\<Help..." ;
	KEY F1, "F1"
DEFINE BAR _MST_MACRO OF system PROMPT "\<Macros"
DEFINE BAR 4 OF system PROMPT "\-"
DEFINE BAR _MST_CALCU OF system PROMPT "\<Calculator"
DEFINE BAR _MST_DIARY OF system PROMPT "Calendar/\<Diary"
DEFINE BAR _MST_PUZZL OF system PROMPT "Pu\<zzle"
DEFINE BAR 8 OF system PROMPT "\-"
DEFINE BAR 9 OF system PROMPT "\<Quit" ;
	SKIP FOR skipvar
ON SELECTION BAR 1 OF system ;
	DO _qb70x9104 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 9 OF system ;
	DO _qb70x9105 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")

DEFINE POPUP edit MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR _MED_CUT OF edit PROMPT "Cu\<t" ;
	KEY CTRL+X, "^X"
DEFINE BAR _MED_COPY OF edit PROMPT "\<Copy" ;
	KEY CTRL+C, "^C"
DEFINE BAR _MED_PASTE OF edit PROMPT "\<Paste" ;
	KEY CTRL+V, "^V"
DEFINE BAR _MED_SP200 OF edit PROMPT "\-"
DEFINE BAR _MED_CLEAR OF edit PROMPT "Clear"
DEFINE BAR _MED_SLCTA OF edit PROMPT "Select \<All" ;
	KEY CTRL+A, "^A"
DEFINE BAR _MED_SP300 OF edit PROMPT "\-"
DEFINE BAR _MED_PREF OF edit PROMPT "\<Preferences..."

DEFINE POPUP applic MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF applic PROMPT "\<Top" ;
	KEY F2, "F2" ;
	SKIP FOR skipvar or bof()
DEFINE BAR 2 OF applic PROMPT "\<Bottom" ;
	KEY F3, "F3" ;
	SKIP FOR skipvar or eof()
DEFINE BAR 3 OF applic PROMPT "\<Next" ;
	KEY F4, "F4" ;
	SKIP FOR skipvar or eof()
DEFINE BAR 4 OF applic PROMPT "\<Prior" ;
	KEY F5, "F5" ;
	SKIP FOR skipvar or bof()
DEFINE BAR 5 OF applic PROMPT "\-"
DEFINE BAR 6 OF applic PROMPT "\<Add record" ;
	KEY CTRL+N, "^N" ;
	SKIP FOR skipvar
DEFINE BAR 7 OF applic PROMPT "\<Copy record " ;
	SKIP FOR skipvar
DEFINE BAR 8 OF applic PROMPT "\<Delete record" ;
	KEY CTRL+D, "^D" ;
	SKIP FOR skipvar
DEFINE BAR 9 OF applic PROMPT "\-"
DEFINE BAR 10 OF applic PROMPT "Bro\<wse" ;
	KEY CTRL+B, "^B" ;
	SKIP FOR skipvar
DEFINE BAR 11 OF applic PROMPT "\<Search..." ;
	KEY CTRL+S, "^S" ;
	SKIP FOR skipvar
DEFINE BAR 12 OF applic PROMPT "\<Filter..." ;
	KEY CTRL+F, "^F" ;
	SKIP FOR skipvar
DEFINE BAR 13 OF applic PROMPT "\<Order..." ;
	KEY CTRL+O, "^O" ;
	SKIP FOR skipvar
DEFINE BAR 14 OF applic PROMPT "\-"
DEFINE BAR 15 OF applic PROMPT "Pick \<list" ;
	KEY CTRL+L, "^L" ;
	SKIP FOR m.skipvar or m.nextdbf <= 2
DEFINE BAR 16 OF applic PROMPT "\-"
DEFINE BAR 17 OF applic PROMPT "\<Query..." ;
	KEY CTRL+Q, "^Q" ;
	SKIP FOR skipvar or ('EXE' $ VERSION())
DEFINE BAR 18 OF applic PROMPT "\<Report..." ;
	KEY CTRL+R, "^R" ;
	SKIP FOR skipvar
ON SELECTION BAR 1 OF applic ;
	DO _qb70x9162 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 2 OF applic ;
	DO _qb70x9189 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 3 OF applic ;
	DO _qb70x918a ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 4 OF applic ;
	DO _qb70x919o ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 6 OF applic ;
	DO _qb70x91ap ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 7 OF applic ;
	DO _qb70x91bd ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 8 OF applic ;
	DO _qb70x91be ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 10 OF applic ;
	DO _qb70x91ct ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 11 OF applic ;
	DO _qb70x91di ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 12 OF applic ;
	DO _qb70x91e6 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 13 OF applic ;
	DO _qb70x91eu ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 15 OF applic DO showpop WITH ALIAS(),VARREAD()

ON SELECTION BAR 17 OF applic ;
	DO _qb70x91fz ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 18 OF applic ;
	DO _qb70x91hm ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")

DEFINE POPUP utilities MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF utilities PROMPT "\<Refresh screen" ;
	SKIP FOR skipvar
DEFINE BAR 2 OF utilities PROMPT "\<Construct index" ;
	SKIP FOR skipvar
DEFINE BAR 3 OF utilities PROMPT "\<Pack " ;
	SKIP FOR skipvar
DEFINE BAR 4 OF utilities PROMPT "\<Environment" ;
	SKIP FOR skipvar
ON SELECTION BAR 1 OF utilities ;
	DO _qb70x91i4 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 2 OF utilities ;
	DO _qb70x91kb ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 3 OF utilities ;
	DO _qb70x91kc ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON BAR 4 OF utilities ACTIVATE POPUP enviro

DEFINE POPUP enviro MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF enviro PROMPT "\<Status Bar"
DEFINE BAR 2 OF enviro PROMPT "\<Clock"
DEFINE BAR 3 OF enviro PROMPT "\<Extended video"
DEFINE BAR 4 OF enviro PROMPT "S\<ticky"
DEFINE BAR 5 OF enviro PROMPT "S\<hadow"
ON SELECTION BAR 1 OF enviro ;
	DO _qb70x91lp ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 2 OF enviro ;
	DO _qb70x91nx ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 3 OF enviro ;
	DO _qb70x91ny ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 4 OF enviro ;
	DO _qb70x91pa ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 5 OF enviro ;
	DO _qb70x91pb ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                        Cleanup Code & Procedures               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

SET MARK OF BAR 1 OF enviro TO (SET("STATUS") = "ON")
SET MARK OF BAR 2 OF enviro TO (SET("CLOCK") = "ON")
SET MARK OF BAR 3 OF enviro TO (SROWS() > 25)
SET MARK OF BAR 4 OF enviro TO (SET("STICKY") = "ON")
SET MARK OF BAR 5 OF enviro TO (SET("SHADOW") = "ON")



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X9104  ON SELECTION BAR 1 OF POPUP system          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:    5        
*        Called By:  ON SELECTION BAR 1 OF POPUP system          
*        Prompt:     About...                                    
*        Snippet:    1                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x9104
IF !regen
   mname = 'appabout.prg'
ELSE
   mname = 'appabout.spr'
ENDIF
DO (mname)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X9105  ON SELECTION BAR 9 OF POPUP system          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   13        
*        Called By:  ON SELECTION BAR 9 OF POPUP system          
*        Prompt:     Quit                                        
*        Snippet:    2                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x9105
* Select the main database
dbfstem = juststem(m.dbfname)
SELECT (dbfstem)
=actwin(m.win_name)

bailout = .T.
CLEAR READ







*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X9162  ON SELECTION BAR 1 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   26        
*        Called By:  ON SELECTION BAR 1 OF POPUP applic          
*        Prompt:     Top                                         
*        Snippet:    3                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x9162
GOTO TOP
ACTIVATE WINDOW appctrl
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X9189  ON SELECTION BAR 2 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   27        
*        Called By:  ON SELECTION BAR 2 OF POPUP applic          
*        Prompt:     Bottom                                      
*        Snippet:    4                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x9189
GOTO BOTTOM
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X918A  ON SELECTION BAR 3 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   28        
*        Called By:  ON SELECTION BAR 3 OF POPUP applic          
*        Prompt:     Next                                        
*        Snippet:    5                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x918a
SKIP
IF EOF()
   WAIT WINDOW "Bottom of file" NOWAIT
   GOTO BOTTOM
ENDIF
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X919O  ON SELECTION BAR 4 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   29        
*        Called By:  ON SELECTION BAR 4 OF POPUP applic          
*        Prompt:     Prior                                       
*        Snippet:    6                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x919o
SKIP -1
IF BOF()
   WAIT WINDOW "Top of file" NOWAIT
   GOTO TOP
ENDIF
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91AP  ON SELECTION BAR 6 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   31        
*        Called By:  ON SELECTION BAR 6 OF POPUP applic          
*        Prompt:     Add record                                  
*        Snippet:    7                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91ap
* Add a record to the current database
EXTERNAL ARRAY dbflist

PRIVATE allblank, i, fldname, sname, c_rec

IF (m.nextdbf <= 2) OR (ALIAS() = dbflist[1,m.cstemnum])
   * Appending into main database

   * Always allow this if there are no records; otherwise check for existing
   * blank records.
   allblank = .F.
   IF RECCOUNT() > 0
      sname = juststem(m.dbfname)
      SELECT &sname
      GOTO TOP

      DO WHILE DELETED() AND !EOF()
         SKIP
      ENDDO
      IF EOF()   && all records appear to be deleted
         GOTO TOP
      ENDIF

      =actwin(m.win_name)

      m.allblank = .T.
      FOR i = 1 TO FCOUNT()
         m.fldname = FIELD(i)
         IF !EMPTY(&fldname)
            m.allblank = .F.
         ENDIF
      ENDFOR

      * Make sure all records aren't deleted
      IF m.allblank
         IF RECCOUNT() < 10   && just a rule of thumb
            COUNT FOR !DELETED() TO notdel
            GOTO TOP
            IF m.notdel = 0
               m.allblank = .F.
            ENDIF
         ENDIF
      ENDIF
   ENDIF

   IF !m.allblank
      APPEND BLANK
      SHOW GETS
   ENDIF

   _CUROBJ = 1

   =actwin(m.win_name)

ELSE   && appending record into a child browse
   * Fill in the key fields.  First find the dbflist record for this
   * database.
   i = 1
   got_it = .F.
   DO WHILE i <= m.numareas AND !got_it
      IF UPPER(dbflist[i,m.cstemnum]) == ALIAS()
         got_it = .T.
      ELSE
         i = i + 1
      ENDIF
   ENDDO
   * If we found the current database, figure out what its key field is
   * and make it default to the corresponding value in the parent database.
   * For example, if the current database is an invoice file, make the
   * customer number default to the customer number of the current record
   * in the customer file.
   APPEND BLANK
   IF got_it
      * dbflist[i,m.cfldnum] looks like "DETAIL.INO"
      childfld  = dbflist[i,m.cfldnum]
      parentfld = dbflist[i,m.pfldnum]

      * Replace the key field into the newly appended record
      REPLACE &childfld WITH &parentfld
   ENDIF
   SHOW WINDOW (ALIAS()) REFRESH
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91BD  ON SELECTION BAR 7 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   32        
*        Called By:  ON SELECTION BAR 7 OF POPUP applic          
*        Prompt:     Copy record                                 
*        Snippet:    8                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91bd
SCATTER MEMVAR
APPEND BLANK
GATHER MEMVAR
IF TYPE("DBFLIST") = "U" OR ALIAS() == UPPER(dbflist[1,m.cstemnum])
   SHOW GETS
   =actwin(m.win_name)   && activate user window
ENDIF

IF WEXIST(ALIAS())
   SHOW WINDOW (ALIAS()) REFRESH
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91BE  ON SELECTION BAR 8 OF POPUP applic          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   33        
*        Called By:  ON SELECTION BAR 8 OF POPUP applic          
*        Prompt:     Delete record                               
*        Snippet:    9                                           
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91be
IF RECCOUNT() > 0
   DELETE
   IF TYPE("DBFLIST") = "U" OR ALIAS() = dbflist[1,m.cstemnum]
      IF !EOF()
         SKIP
      ENDIF
      IF EOF()
         GOTO TOP
      ENDIF
      SHOW GETS
   ENDIF
   IF WEXIST(ALIAS())
      SHOW WINDOW (ALIAS()) REFRESH
   ENDIF
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91CT  ON SELECTION BAR 10 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   35        
*        Called By:  ON SELECTION BAR 10 OF POPUP applic         
*        Prompt:     Browse                                      
*        Snippet:    10                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91ct
m.skipvar = .T.
dbfstem = juststem(m.dbfname)
SELECT (dbfstem)
ON KEY LABEL enter KEYBOARD(CHR(23))
BROWSE LAST NORMAL NOAPPEND COLOR SCHEME 10
ON KEY LABEL enter
SHOW MENU _msysmenu
m.skipvar = .F.
=actwin(m.win_name)
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91DI  ON SELECTION BAR 11 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   36        
*        Called By:  ON SELECTION BAR 11 OF POPUP applic         
*        Prompt:     Search...                                   
*        Snippet:    11                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91di
dbfstem = juststem(m.dbfname)
SELECT (dbfstem)
IF !regen
   mname = 'appsrch.prg'
ELSE
   mname = 'appsrch.spr'
ENDIF
DO (mname)
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91E6  ON SELECTION BAR 12 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   37        
*        Called By:  ON SELECTION BAR 12 OF POPUP applic         
*        Prompt:     Filter...                                   
*        Snippet:    12                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91e6
m.orig_rec = RECNO()
GETEXPR 'Filter Expression' TO filt_expr TYPE 'L' DEFAULT filt_expr
IF !EMPTY(m.filt_expr)
   SET FILTER TO &filt_expr
   GOTO TOP
   IF EOF()
      WAIT WINDOW "No records match that filter" NOWAIT
      SET FILTER TO
      IF m.orig_rec <= RECCOUNT()
         GOTO m.orig_rec
      ENDIF
   ENDIF
ELSE
   SET FILTER TO
ENDIF
SHOW GETS



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91EU  ON SELECTION BAR 13 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   38        
*        Called By:  ON SELECTION BAR 13 OF POPUP applic         
*        Prompt:     Order...                                    
*        Snippet:    13                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91eu
dbfstem = juststem(m.dbfname)
SELECT (dbfstem)
IF !EMPTY(CDX(1))
   IF !regen
      mname = 'getorder.prg'
   ELSE
      mname = 'getorder.spr'
   ENDIF
   DO (mname)
   SHOW GETS
ELSE
   WAIT WINDOW "No indexes were found"
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91FZ  ON SELECTION BAR 17 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   42        
*        Called By:  ON SELECTION BAR 17 OF POPUP applic         
*        Prompt:     Query...                                    
*        Snippet:    14                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91fz
PRIVATE gen_name, i, qname, pname, win_name

CREATE VIEW qprview

* Select the main database
dbfstem = juststem(m.dbfname)
SELECT (dbfstem)

skipvar = .T.
gen_name = .F.

* Default query name is the database name with a QPR extension.
m.qname = addbs(qprpath) + forceext(justfname(m.dbfname),'QPR')

* If there are multiple databases in this app, create a query template
* so that the user doesn't have to enter all the relations again.
IF m.nextdbf > 2 AND TYPE("dbflist") <> "U"
   * Create a blank query file to pass the databases and relations
   * along to RQBE

   * Try to come up with a reasonable-sounding unique name for the query,
   * if the default name is already taken.
   i = 0
   DO WHILE FILE(m.qname) AND i < 100
      m.qname = ALLTRIM(LEFT(juststem(m.qname),6)) + STR(i,2)
      m.qname = CHRTRAN(m.qname,' ','0')
      m.qname = forceext(m.qname,'QPR')
      m.qname = addbs(m.qprpath) + m.qname
      i = i + 1
   ENDDO

   * Prompt the user for the query name and allow changes.
   * Change to the directory the user wants to use so that the
   * PUTFILE directory defaults are right.
   in_dir = SET('DEFAULT')+CURDIR()
   SET DEFAULT TO &qprpath
   m.qname = PUTFILE('Query name',m.qname,'QPR','OK')
   SET DEFAULT TO &in_dir

   IF EMPTY(m.qname)   && user changed his mind.
      skipvar = .F.
      RETURN
   ELSE
      * Use this path for future queries
      qprpath = justpath(m.qname)
   ENDIF

   * Create the query template file
   SET TEXTMERGE TO &qname
   SET TEXTMERGE ON
   SET CONSOLE OFF

   gen_name = .T.     && note that this is a generated file

   \SELECT * ;
   \ FROM <<dbflist[1,m.cstemnum]>>
   FOR i = 2 TO m.nextdbf - 1
      \\, <<dbflist[i,m.cstemnum]>>
   ENDFOR
   \\ ;
   \ WHERE ;
   FOR i = 2 TO m.nextdbf - 1
      IF i > 2
         \   AND
      ELSE
         \
      ENDIF
      \\   <<dbflist[i,m.cfldnum]>> = <<dbflist[i,m.pfldnum]>> ;
   ENDFOR
   \INTO CURSOR FoxApp
   \BROWSE NOMODIFY

   SET CONSOLE ON
   SET TEXTMERGE OFF
   SET TEXTMERGE TO
ELSE
   * Prompt the user for the query name
   m.qname = PUTFILE('Query name',m.qname,'QPR','OK')
ENDIF

IF !EMPTY(m.qname)
   win_name = WOUTPUT()
   ACTIVATE SCREEN
   IF FILE(m.qname)
      MODIFY QUERY (m.qname)
   ELSE
      CREATE QUERY (m.qname)
   ENDIF
   CLEAR
   IF !EMPTY(m.win_name)
      ACTIVATE WINDOW (m.win_name)
   ENDIF
ELSE
   * Delete this file if it was a generated file and the
   * user cancelled the query.
   IF m.gen_name AND FILE(m.qname)
      DELETE FILE m.qname
   ENDIF
ENDIF
IF EMPTY(opendbf(m.dbfname))
   m.dbfname = LOCFILE(m.dbfname,'DBF','Please locate the database')
ENDIF
skipvar = .F.

IF FILE('qprview.vue')
   SET VIEW TO qprview
ENDIF
KEYBOARD CHR(27)   && force screen refresh



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91HM  ON SELECTION BAR 18 OF POPUP applic         
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   43        
*        Called By:  ON SELECTION BAR 18 OF POPUP applic         
*        Prompt:     Report...                                   
*        Snippet:    15                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91hm
IF !regen
   mname = 'prtopts.prg'
ELSE
   mname = 'prtopts.spr'
ENDIF
DO (mname)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91I4  ON SELECTION BAR 1 OF POPUP utilities       
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   46        
*        Called By:  ON SELECTION BAR 1 OF POPUP utilities       
*        Prompt:     Refresh screen                              
*        Snippet:    16                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91i4
ACTIVATE WINDOW (win_name)
KEYBOARD CHR(27)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91KB  ON SELECTION BAR 2 OF POPUP utilities       
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   47        
*        Called By:  ON SELECTION BAR 2 OF POPUP utilities       
*        Prompt:     Construct index                             
*        Snippet:    17                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91kb
DO invert WITH ALIAS()
SET ORDER TO 1
GOTO TOP
_CUROBJ = 1
WAIT WINDOW "Reindexing completed" NOWAIT
SHOW GETS




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91KC  ON SELECTION BAR 3 OF POPUP utilities       
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   48        
*        Called By:  ON SELECTION BAR 3 OF POPUP utilities       
*        Prompt:     Pack                                        
*        Snippet:    18                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91kc
PACK   && also reindexes the file
SET ORDER TO 1
GOTO TOP
IF RECCOUNT() = 0
   APPEND BLANK
ENDIF
WAIT WINDOW "Pack completed" NOWAIT
KEYBOARD CHR(27)    && causes screen refresh and restores browses
SHOW GETS




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91LP  ON SELECTION BAR 1 OF POPUP enviro          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   51        
*        Called By:  ON SELECTION BAR 1 OF POPUP enviro          
*        Prompt:     Status Bar                                  
*        Snippet:    19                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91lp
STORE MRKBAR("ENVIRO",BAR()) TO m.markset
IF m.markset
   SET STATUS OFF
   SET MARK OF BAR BAR() OF enviro TO .F.
ELSE
   SET STATUS ON
   SET MARK OF BAR BAR() OF enviro TO .T.
ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91NX  ON SELECTION BAR 2 OF POPUP enviro          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   52        
*        Called By:  ON SELECTION BAR 2 OF POPUP enviro          
*        Prompt:     Clock                                       
*        Snippet:    20                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91nx
STORE MRKBAR("ENVIRO",BAR()) TO m.markset
IF m.markset
   SET CLOCK OFF
   SET MARK OF BAR BAR() OF enviro TO .F.
ELSE
   SET CLOCK ON
   SET MARK OF BAR BAR() OF enviro TO .T.
ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91NY  ON SELECTION BAR 3 OF POPUP enviro          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   53        
*        Called By:  ON SELECTION BAR 3 OF POPUP enviro          
*        Prompt:     Extended video                              
*        Snippet:    21                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91ny
STORE MRKBAR("ENVIRO",BAR()) TO m.markset
IF m.markset
   SET DISPLAY TO VGA25
   SET MARK OF BAR BAR() OF enviro TO .F.
ELSE
   SET DISPLAY TO VGA50
   SET MARK OF BAR BAR() OF enviro TO .T.
ENDIF
KEYBOARD CHR(27)
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91PA  ON SELECTION BAR 4 OF POPUP enviro          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   54        
*        Called By:  ON SELECTION BAR 4 OF POPUP enviro          
*        Prompt:     Sticky                                      
*        Snippet:    22                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91pa
STORE MRKBAR("ENVIRO",BAR()) TO m.markset
IF m.markset
   SET STICKY OFF
   SET MARK OF BAR BAR() OF enviro TO .F.
ELSE
   SET STICKY ON
   SET MARK OF BAR BAR() OF enviro TO .T.
ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QB70X91PB  ON SELECTION BAR 5 OF POPUP enviro          
*                                                                
*        Procedure Origin:                                       
*                                                                
*        From Menu:  APPMENU.PRG,            Record:   55        
*        Called By:  ON SELECTION BAR 5 OF POPUP enviro          
*        Prompt:     Shadow                                      
*        Snippet:    23                                          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
PROCEDURE _qb70x91pb
STORE MRKBAR("ENVIRO",BAR()) TO m.markset
IF m.markset
   SET SHADOW OFF
   SET MARK OF BAR BAR() OF enviro TO .F.
ELSE
   SET SHADOW ON
   SET MARK OF BAR BAR() OF enviro TO .T.
ENDIF
RETURN

